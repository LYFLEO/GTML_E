%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Copyright (c) 2014-2018
% Athor: Yang Shubo
% Date: 2018/12/14
% Version: 1.1
% Describe:
% 	Give temperature 'T(K)[200K~3000K]',
%       fuel air ratio 'FAR(-)',
%       flag 'Oil/Gas'. 
%   Return corresponding 'H(J/kg)'.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function H = H_T( T, FAR, flag )

if nargin == 1
    FAR = 0;
    flag = 'Oil';
elseif nargin == 2
    flag = 'Oil';
end

if T < 200
    T = 200;
elseif T > 3000
    T = 3000;
end

H = 0;

if strcmp(flag, 'Gas')
    
    Xm = Fuel_Composition( 1, FAR );
    fX = zeros( 1, 4 );
    kX = [ 28 32 44 18 ];

    if Xm(1) > 1e-5
        fX(1) = 2.475830346e6*273.15*(T/273.15)^(1)-2.815239891e4*(-546.3)*(T/273.15)^(-0.5)+1.116401165e5*(-1.0926e3)*(T/273.15)^(-0.25)-8.147644187e5*(1.0926e3)*(T/273.15)^(0.25)+2.185120405e6*546.3*(T/273.15)^(0.5)-2.978031305e6*364.2*(T/273.15)^(0.75)-1.308008001e6*218.52*(T/273.15)^(1.25)+4.305948510e5*182.1*(T/273.15)^(1.5)-8.082302563e4*156.0857*(T/273.15)^(1.75)+6.622545214e3*136.575*(T/273.15)^(2)+4.305300363e8;
    end

    if Xm(2) > 1e-5
        fX(2) = 6.408242565e5*273.15*(T/273.15)^(1)-1.599937045e3*(-546.3)*(T/273.15)^(-0.5)+9.984801256e3*(-1.0926e3)*(T/273.15)^(-0.25)-1.280873444e5*(1.0926e3)*(T/273.15)^(0.25)+4.186599156e5*546.3*(T/273.15)^(0.5)-6.720142804e5*364.2*(T/273.15)^( 0.75)-3.799977202e5*218.52*(T/273.15)^(1.25)+1.378691801e5*182.1*(T/273.15)^(1.5)-2.806954185e4*156.0857*(T/273.15)^(1.75)+2.459943097e3*136.575*(T/273.15)^(2)+5.295253592e7;
    end

    if Xm(3) > 1e-5
        fX(3) = 1.103695150e6*273.15*(T/273.15)^(1)-1.365096910e4*(-546.3)*(T/273.15)^(-0.5)+5.357704944e4*(-1.0926e3)*(T/273.15)^(-0.25)-3.816063864e5*(1.0926e3)*(T/273.15)^( 0.25)+1.008950325e6*546.3*(T/273.15)^(0.5)-1.352938737e6*364.2*(T/273.15)^(0.75)-5.701809626e5*218.52*(T/273.15)^(1.25)+1.828513133e5*182.1*(T/273.15)^(1.5)-3.329618224e4*156.0857*(T/273.15)^(1.75)+2.635366727e3*136.575*(T/273.15)^(2)+2.042361458e8;
    end

    if Xm(4) > 1e-5
        fX(4) = -4.747782033e6*273.15*(T/273.15)^(1)+4.799919289e4*(-546.3)*(T/273.15)^(-0.5)-1.931588954e5*(-1.0926e3)*(T/273.15)^(-0.25)+1.460728340e6*(1.0926e3)*(T/273.15)^(0.25)-4.000075762e6*546.3*(T/273.15)^(0.5)+5.576209858e6*364.2*(T/273.15)^(0.75)+2.570488297e6*218.52*(T/273.15)^(1.25)-8.670521019e5*182.1*(T/273.15)^(1.5)+1.666429390e5*156.0857*(T/273.15)^(1.75)-1.396634620e4*136.575*(T/273.15)^(2)-7.574888563e8;
    end

    for i = 1 : 4           
        H = H + fX(i) * Xm(i) / kX(i);
    end
else

    tz = T / 1000;
    Xm = FAR/(1 + FAR); 
    H = 0.992313*tz+0.236688*tz^2/2-1.852148*tz^3/3+6.083152*tz^4/4-8.893933*tz^5/5+7.097112*tz^6/6-3.234725*tz^7/7+0.794571*tz^8/8-0.081873*tz^9/9+0.422178;
 
    if FAR > 1e-5
        H = H+Xm*(-0.718874*tz+8.747481*tz^2/2-15.863157*tz^3/3+17.254096*tz^4/4-10.233795*tz^5/5+3.081778*tz^6/6-0.361112*tz^7/7+0.0555930);
    end
    
    H = H * 1e3;
end

H = H * 1e3;
end
